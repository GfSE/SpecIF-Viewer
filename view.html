<!DOCTYPE html>
<html>
<head>
    <title>SpecIF View</title>
	<link rel="icon" type="image/png" href="./favicon.ico">
	<meta charset="utf-8" />
	<!--<meta http-equiv="cache-control" content="no-Cache" />-->
	<meta http-equiv="expires" content="0" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="./v0.95.6/modules.js"></script>
</head>
<body>

<div id="app" class="noOverflow " >
	<div id="pageHeader" >
		<div id="logo" ></div>
		<div id="pageSelector" class="btn-group btn-group-md pageActions" ></div>
		<div id="spinner" ></div>
		<div id="pageTitle" class="pageTitle" ></div>
	</div>
</div>

<script type="text/javascript">
app = {
	label: '',
	init: function() {
		// must set it here, because the language files must be read first:
		CONFIG.productTitle = 'Interactive-Spec';
		CONFIG.specifVersion = '0.10.8';
		this.label = i18n.LblReader;
		// create the options after loading required libraries such as 'i18n':
		let define = {
			// Define 
			// - name: the modules to load as specified in 'modules.js'
			// - loadAs: name for execution (addressable javascript object) 
			// - the hierarchy of views using implicit actions hide/show or refresh
			// - the explicit actions independent of any view
			
			// Let's start:
			// no name, thus no additional script file will be loaded at top level
			view: '#app',
			selector: '#pageSelector',		// DOM element to choose the view of a child (top level)
			selectorType: 'btns',
			children: [{
				name: 'profileAnonymous',
				loadAs: 'me'					// the name of the controller object to construct
				// no view
			},{
				name: 'cache'
				// no view
			},{
				name: 'importAny',
				// no loadAs, so name will be used for the controller object
				// This is a view of the parent:
				view: '#import',				// uses implicit actions show/hide
				viewClass: 'contentWide',		// whole width under control of the view
				label: i18n.BtnImport,
				selectedBy: '#selectImport',	// DOM element in parent's selector to choose this view
				// no selector: this module is itself responsible for managing it's children
				children: [{
					name: 'ioSpecif'
					// no view
				},{
					name: 'ioReqif'
					// no view
				},{
					name: 'ioBpmn'
					// no view
				},{
					name: 'ioXls'
					// no view
				}]
			}, {
				name: CONFIG.specifications,
				loadAs: 'specs',					// the name of the controller object to construct
				// This is a view of the parent:
				view: '#'+CONFIG.specifications,	// uses implicit actions show/hide
				label: i18n.BtnRead,
				selectedBy: '#selectSpecs',			// DOM element in parent's selector to choose this view
				// To control the views of the children:
				selector: '#specsSelector',			// DOM element to choose the view of a child (next level)
				selectorType: 'tabs',
				children: [{
					// nothing to load, code is contained in parent's file
					// Definitions as a view of the parent:
					view: '#'+CONFIG.objectList,	// uses implicit action refresh at parent level
					viewClass: 'content',
					label: i18n.TabDocument,
					selectedBy: '#selectDocument'	// DOM element in parent's selector to choose this view
				},{
					// nothing to load, code is contained in parent's file
					// Definitions as a view of the parent:
					view: '#'+CONFIG.relations,		// uses implicit action refresh at parent level
					viewClass: 'content',
					label: i18n.TabRelations,
					selectedBy: '#selectStatements',	// DOM element in parent's selector to choose this view
					children: [{
						name: 'statementsGraph'
						// no view
					}]
				},{
					name: CONFIG.objectFilter,
					// no loadAs, so name will be used for the controller object
					// Definitions as a view of the parent:
					view: '#'+CONFIG.objectFilter,	// uses implicit action refresh at parent level
					viewClass: 'contentWide',		// whole width under control of the view
					label: i18n.TabFilter,
					selectedBy: '#selectFilters'	// DOM element in parent's selector to choose this view
				},{
					name: CONFIG.reports,
					// no loadAs, so name will be used for the controller object
					// Definitions as a view of the parent:
					view: '#'+CONFIG.reports,		// uses implicit action refresh at parent level
					viewClass: 'contentWide',		// whole width under control of the view
					label: i18n.TabReports,
					selectedBy: '#selectReports'	// DOM element in parent's selector to choose this view
				}]
			}, {
				action: 'app.cache.export()',
				label: i18n.BtnExport,
				selectedBy: '#selectExport',		// DOM element in parent's selector to initiate this action
				// no selector: this module is itself responsible for managing it's children
				children: [{
					name: 'toEpub'
					// no view
				},{
					name: 'toOxml'
					// no view
				}]
			}]
		};

//		console.debug( this.label+" will be initialized!" );
		document.title = this.label;
	//	$('#pageTitle').html(i18n.AppReader);

//		window.addEventListener("hashchange", this.options.callback );
		bindResizer();
		
		modules.load( define, {done:function() { app.show() }} )
	},
	show: function() {
		console.info( this.label+" started!" );
		this.me.read()
			.done(function() {
				modules.show('#import')
			})
			.fail(function() {
				this.hide()
			})
	},
	hide: function() {
		// hide the shown module:
		// ToDo
	},
/*	updateMe: function() {
		message.hide();
		this.hide();
//		me.beginUpdate()
	},
	logout: function() {
//		me.logout();
		this.hide();
	} */
};

$( function() {
	// The DOM is ready.
	app.busy = new State({
		showWhenSet: ['#spinner'],
		hideWhenSet: ['.pageActions','#contentActions']
	});
	// Submit all modules to load and the function to start the app thereafter:
	modules.init({
		appVersion: '0.95.6',
		done: app.init
	})
});	
	
</script>  
</body>
</html>