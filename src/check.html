<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="expires" content="0" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" href="./assets/icons/favicon.ico" type="image/x-icon">
	<link rel="icon" href="./assets/icons/favicon.ico" type="image/x-icon">
</head>
<body>

<div id="app" class="noOverflow" >
	<div id="pageHeader">
		<div id="logo"></div>
		<div id="pageSelector" class="btn-group pageActions"></div>
		<div id="spinner"><i class="fa fa-spinner fa-spin"></i></div>
		<div id="pageTitle" class="pageTitle"></div>
	</div>
</div>

<script type="text/javascript">

// This is a template for SpecIF apps: The filename is different, but the content is identical.
// Thus, to create a new SpecIF app
// - copy this file and rename it with the desired app title
// - in the moduleTree below, include the modules to load for the particular app.

    // App-specific code called by the moduleManager after initializing;
    // the moduleTree defines the modules to load:
    function SpecifApp() {
        "use strict";

        // construct main app:
        var self = {};

        // Define the module hierarchy; it will be used to load the modules and to control the views later on:
	self.moduleTree = {
		// Define
		// - name: the modules to load as specified in 'moduleManager.js'
		// - loadAs: name for execution (addressable javascript object)
		// - the hierarchy of views using implicit actions hide/show or refresh
		// - the explicit actions independent of any view

		// Let's start at the top level:
		// no name, thus no additional script file will be loaded at top level
		view: '#app',
		selector: '#pageSelector',			// DOM element to choose the view of a child (top level)
		selectorType: 'btns',
		children: [{
			name: 'profileAnonymous',
			loadAs: 'me'					// the name of the controller object to construct
			// no view
		}, {
			name: 'cache',
			loadAs: 'projects'
			// no view
		}, {
			name: 'importAny',
			// no loadAs, so name will be used for the controller object
			// This is a view of the parent:
			view: '#' + CONFIG.importAny,	// uses implicit actions show/hide
			viewClass: 'contentWide',		// whole width under control of the view
			label: i18n.BtnImport,
			selectedBy: '#selectImport',	// DOM element in parent's selector to choose this view
			// no selector: the children don't have views
			children: [{
				name: 'ioSpecif'
			}, {
				name: 'ioArchimate'
			}, {
				name: 'ioReqif'
			}, {
				name: 'ioBpmn'
			}, {
				name: 'ioXls'
			}]
		}, {
			name: 'about',
			view: '#about',
			viewClass: 'contentWide',			// whole width under control of the view
			label: i18n.IcoAbout,
			selectedBy: '#selectAbout'			// DOM element in parent's selector to choose this view
		}]
	};

        // IE does not support ()=>{..} --> "syntax error" at load time.
        self.init = function () {
            // must set it here, because the language files must be read first:
            document.title = self.title = i18n.LblEditor;

            // React on Browser Back/Forward buttons:
            window.addEventListener("hashchange", self.show);
            // Warn before leaving the page (browser back button or tab deletion ... or outgoing link):
            window.onbeforeunload = function () {
                return "You are about to leave this application - did you save any changes you made?";
            };

            moduleManager.load(self.moduleTree, { done: self.login });
        };
        self.login = function () {
            console.info(self.title + " " + CONFIG.appVersion + " started!");
            self.me.login()
                .then(
                    self.show,
                    self.logout
                )
        };
        self.show = function () {
            var uP = getUrlParams(), v;
            if (!self[CONFIG.projects].selected
                || !self[CONFIG.projects].selected.isLoaded()
                || uP[CONFIG.keyProject] && uP[CONFIG.keyProject] != self[CONFIG.projects].selected.id
                || uP[CONFIG.keyImport] && uP[CONFIG.keyImport].length > 0)
                // - no project is loaded
                // - a project id is found in the URL parameters and it differs from the one of the loaded project
                // - an URL parameter 'import' has been found:
                v = '#' + CONFIG.importAny
            else
                v = '#' + (uP[CONFIG.keyView] || CONFIG.specifications);
            //		console.debug( 'app.show', uP, v );
            moduleManager.show({ view: v, urlParams: uP });
        };
        self.export = function () {
            if (self[CONFIG.projects].selected && self[CONFIG.projects].selected.isLoaded())
                self[CONFIG.projects].selected.chooseFormatAndExport();
            else
                message.show(i18n.MsgNoProjectLoaded, { severity: 'warning', duration: CONFIG.messageDisplayTimeShort });
        };
        /*	self.updateMe = function() {
                self.me.beginUpdate();
            }; */
        self.logout = function () {
            self.me.logout();
            self.hide();
        };
        self.hide = function () {
            // hide the app and show the login dialog:
            // ToDo
        };
        self.init();
        return self;
    }

	// see https://www.sitepoint.com/community/t/window-load-function-getscript-not-jquery/195657/3
	function getScript(url) {
		var el = document.createElement('script');
		el.onload = function() {
						if( --pend<1 )
							moduleManager.init();
					};
		el.src = url;
		document.body.appendChild(el)
	}

// Get three fundamental libraries in parallel, then initialize the moduleManager using 'moduleManager.init' ..
let fileName = /.*\/([^.?#]*)(?:\.html)?(?:#.*)?$/.exec(window.location.href)[1],
    pend=3;
getScript( 'https://code.jquery.com/jquery-3.7.1.min.js' );
getScript( './config/definitions.js?'+ Date.now().toString() ); // with cache-busting
getScript( './config/moduleManager.js?'+ Date.now().toString() );

</script>
<noscript>
<p>The execution of JavaScript is disabled by your browser or the server.</p>
</noscript>
</body>
</html>